<!-- $Id$ -->
<!--
   Copyright (C) 2009 by Gregory Shikhman <cornmander@cornmander.com>
   Part of the Battle for Wesnoth Project http://www.wesnoth.org/

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License version 2
   or at your option any later version.
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY.

   See the COPYING file for more details.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- ABQIAAAAwlLuIjoG2_E7xGXPjpNRyRTY1qbTKsNyhuhE_ljh2mJHrFJMJRQgNuWe_yAXHi-7Ny4aJ3btOcCGnQ //google maps api key for http://cornmander.com -->
<html xmlns:py="http://genshi.edgewall.org/" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<script type="text/javascript" src="/wesstats/js/calendar.js"></script>
	<link rel="stylesheet" rev="stylesheet" href="/wesstats/css/calendar.css" media="screen" />
	<style type="text/css">@import url('http://www.wesnoth.org/mw/skins/glamdrol/main.css');</style>
	<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAAwlLuIjoG2_E7xGXPjpNRyRTY1qbTKsNyhuhE_ljh2mJHrFJMJRQgNuWe_yAXHi-7Ny4aJ3btOcCGnQ" type="text/javascript"></script>
	<script type="text/javascript">
		function generate_hexgrid(map, rows, columns) {
			for(var row = 0; rows - row != 0; row++) {
				for(var col = 0; columns - col != 0; col++) {
					make_hex(map,row,col);
				}
			}
		}

		function make_hex(map, row, col) {
			var PRADIUS; //hex radius
			if(map.getZoom() == 3) {
				PRADIUS = 9.0;
			} else { // getZoom() == 4
				PRADIUS = 18.0;
			}
			var poly = Array();
			var xcenter = 1.5 * PRADIUS * col;
			var ycenter;
			if( col % 2 != 0) {
				ycenter = 2*PRADIUS*row;
			} else {
				ycenter = PRADIUS + (2.0 * PRADIUS * row);
			}
			var p = new GPoint(1*PRADIUS + xcenter,0*PRADIUS + ycenter);
			poly.push(G_NORMAL_MAP.getProjection().fromPixelToLatLng(p,map.getZoom()));
			p = new GPoint(0.5*PRADIUS + xcenter,1*PRADIUS + ycenter);
			poly.push(G_NORMAL_MAP.getProjection().fromPixelToLatLng(p,map.getZoom()));
			p = new GPoint(-0.5*PRADIUS + xcenter,1*PRADIUS + ycenter);
			poly.push(G_NORMAL_MAP.getProjection().fromPixelToLatLng(p,map.getZoom()));
			p = new GPoint(-1*PRADIUS + xcenter,0*PRADIUS + ycenter);
			poly.push(G_NORMAL_MAP.getProjection().fromPixelToLatLng(p,map.getZoom()));
			p = new GPoint(-0.5*PRADIUS + xcenter,-1*PRADIUS + ycenter);
			poly.push(G_NORMAL_MAP.getProjection().fromPixelToLatLng(p,map.getZoom()));
			p = new GPoint(0.5*PRADIUS + xcenter,-1*PRADIUS + ycenter);
			poly.push(G_NORMAL_MAP.getProjection().fromPixelToLatLng(p,map.getZoom()));
			
			var poly_overlay = new GPolygon(poly,"#000000",1,.25,"#000000",.25);
			GEvent.addListener(poly_overlay, "click", function(latlng) {
				if(latlng) {
					var myHtml = "You clicked hex "+col+","+row;
					map.openInfoWindow(latlng, myHtml);
				}
			});
			map.addOverlay(poly_overlay);
		}
		function initialize() {
			if (GBrowserIsCompatible()) {
				var copyright = new GCopyrightCollection("&copy; Wesnoth Project");
				copyright.addCopyright(new GCopyright('test',new GLatLngBounds(new GLatLng(-90,-180), new GLatLng(90,180)) ,0,'2009'));
				
				var minscale = 3;
				var maxscale = 4;
				var tilelayer = new GTileLayer(copyright,minscale,maxscale);
				tilelayer.getTileUrl = function(tile,zoom) { return "/wesstats/images/test_map."+tile.x+"_"+tile.y+"_"+zoom+".jpg"; };
				tilelayer.isPng = function() { return false; };
				tilelayer.getOpacity = function() { return 1.0; };
		
				var wmap_type = new GMapType( [tilelayer], new GMercatorProjection(18), "KillMap", {errorMessage:"No data"});
				
				var map = new GMap2(document.getElementById("map_canvas"),{mapTypes:[wmap_type],backgroundColor:"#000000"});
				map.setCenter(new GLatLng(80, -135), 3, wmap_type);
				map.addControl(new GLargeMapControl());
				generate_hexgrid(map,22,22);
			}
		}
	</script>
</head>
<body onload="initialize()" onunload="GUnload()">
	<div id="header">
		<div id="logo">
			<a href="http://www.wesnoth.org/"><img alt="Wesnoth logo" src="http://www.wesnoth.org/mw/skins/glamdrol/wesnoth-logo.jpg" /></a>
		</div>
		<div id="nav">
			<ul>
				<li><a href="http://www.wesnoth.org/">Home</a></li>
				<li><a href="http://www.wesnoth.org/wiki/Play">Play</a></li>
				<li><a href="http://www.wesnoth.org/wiki/Create">Create</a></li>
				<li><a href="http://www.wesnoth.org/forum/">Forums</a></li>
				<li><a href="http://www.wesnoth.org/wiki/Support">Support</a></li>
				<li><a href="http://www.wesnoth.org/wiki/Project">Project</a></li>
				<li><a href="http://www.wesnoth.org/wiki/Credits">Credits</a></li>
			</ul>
		</div>
	</div>
	<div id="map_canvas" style="width: 800px; height: 600px"><noscript>You must enable Javascript in order to see the kill map.</noscript></div>
</body>
</html>
